<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è£å‰ªä¸Šä¼ åŸç†</title>
  </head>
  <body>
    <div class="container">
      <input type="file" />
      <img class="preview" src="" alt="" style="display: block" />
      <button>ç”Ÿæˆæˆªå›¾åçš„Fileå¯¹è±¡</button>
    </div>

    <script>
      const inpFile = document.querySelector('input[type="file"]')
      const img = document.querySelector('.preview')
      const btn = document.querySelector('button')

      // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
      inpFile.onchange = e => {
        const file = e.target.files[0]
        // è¯»å–æ–‡ä»¶æ•°æ®
        const reader = new FileReader()

        // æ–‡ä»¶è¯»å–å®Œæˆè§¦å‘
        reader.onload = e => {
          // 1. å®ç°æœ¬åœ°é¢„è§ˆ ğŸ”¥
          img.src = e.target.result
          // jså®ç°è£å‰ªæ•ˆæœã€ç¼ºå¤±ï¼Ÿï¼Ÿã€‘ğŸ”¥
        }

        // ä¼ å…¥fileå¯¹è±¡ï¼Œå®ƒä¼šæŠŠæ–‡ä»¶æ•°æ®è¯»å‡ºæ¥ï¼Œç”Ÿæˆä¸€ä¸ªæœ¬åœ°çš„DataURL (è¯»å–çš„è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„)
        reader.readAsDataURL(file)
      }
      // è£å‰ª
      btn.onclick = () => {
        /*
         * æ‹¿åˆ°è£å‰ªåçš„fileå¯¹è±¡ ğŸ”¥
         *  1.åŸå›¾ä¸­çš„è£å‰ªä½ç½®
         *  2.åŸå›¾ä¸­çš„è£å‰ªå®½é«˜
         *  3.è£å‰ªç»“æœç¼©æ”¾åçš„å°ºå¯¸
         */
        const cutInfo = {
          // åŸå›¾ä¸­çš„è£å‰ªä½ç½®
          x: 500,
          y: 500,
          // åŸå›¾ä¸­çš„è£å‰ªå®½é«˜
          cutWidth: 300,
          cutHeight: 300,
          // è£å‰ªç»“æœç¼©æ”¾åçš„å°ºå¯¸
          width: 100,
          height: 100
        }
        // æŠŠå›¾ç‰‡ç»˜ç”»åˆ°canvasä¸Š ğŸ”¥
        const canvas = document.createElement('canvas')
        canvas.width = cutInfo.width
        canvas.height = cutInfo.height
        const ctx = canvas.getContext('2d')

        /**
         * é€šè¿‡ drawImage å®ç°ï¼šæŠŠå›¾ç‰‡ç”»åˆ°canvasç”»å¸ƒä¸Š
         * https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/drawImage
         * drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);
         */
        ctx.drawImage(img, cutInfo.x, cutInfo.y, cutInfo.cutWidth, cutInfo.cutHeight, 0, 0, cutInfo.width, cutInfo.height)
        /*
         * https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLCanvasElement/toBlob
         * toBlob(callback, type, quality)
         *  type: é»˜è®¤æ ¼å¼ï¼ˆæœªæŒ‡å®šæˆ–ä¸æ”¯æŒï¼‰ä¸º image/png
         * 
         * https://developer.mozilla.org/zh-CN/docs/Web/API/File/File
         * var myFile = new File(bits, name[, options]);
         */
        canvas.toBlob(blob => {
          console.log(blob)
          const file = new File([blob], 'avatar.jpeg', {
            type: 'image/jpeg'
          })
          console.log(file)
          // ajax --- file ---> æœåŠ¡å™¨ ğŸ”¥
        }, 'image/jpeg')

        document.body.appendChild(canvas)
      }
    </script>
  </body>
</html>
